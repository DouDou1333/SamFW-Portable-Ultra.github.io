<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S21 FE 5G - TOTAL CONTROL ENGINE</title>
    <style>
        :root { --neon: #00ff41; --bg: #020202; --panel: #111; --danger: #ff3333; --gold: #ffff00; --blue: #00bfff; }
        body { margin: 0; padding: 10px; background: var(--bg); color: var(--neon); font-family: 'Courier New', monospace; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        /* En-t√™te */
        .header { background: #003310; padding: 8px; border: 1px solid var(--neon); display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 8px; box-shadow: 0 0 10px var(--neon); }
        
        /* Guide Lumi√®re "WHILE" */
        #while-guide { background: #001a05; border-left: 5px solid var(--gold); padding: 10px; margin-bottom: 8px; font-size: 0.7rem; color: #aaffaa; border-radius: 4px; overflow-y: auto; max-height: 100px; }
        #while-guide h2 { margin: 0; font-size: 0.85rem; color: var(--gold); text-transform: uppercase; }

        /* Console */
        #console { flex-grow: 1; border: 1px solid var(--neon); background: #000; padding: 10px; overflow-y: auto; font-size: 0.7rem; margin-bottom: 8px; box-shadow: inset 0 0 15px rgba(0,255,65,0.1); }
        .log { border-left: 2px solid #333; padding-left: 8px; margin-bottom: 3px; }
        .success { color: var(--gold); } .err { color: var(--danger); font-weight: bold; } .info { color: var(--blue); }

        /* Grille d'outils */
        .tool-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; overflow-y: auto; padding-bottom: 10px; }
        .tool-box { border: 1px solid var(--neon); background: var(--panel); padding: 6px; border-radius: 4px; }
        .tool-box h4 { margin: -6px -6px 6px -6px; font-size: 0.65rem; text-align: center; background: var(--neon); color: #000; padding: 3px; text-transform: uppercase; }

        button { background: rgba(0,255,65,0.05); color: var(--neon); border: 1px solid var(--neon); padding: 8px 2px; cursor: pointer; font-family: monospace; font-size: 0.65rem; font-weight: bold; width: 100%; margin-bottom: 4px; transition: 0.2s; }
        button:hover { background: var(--neon); color: #000; }
        
        .btn-critical { border-color: var(--danger); color: var(--danger); }
        .btn-critical:hover { background: var(--danger); color: #fff; }
        .btn-root { border-color: var(--gold); color: var(--gold); border-width: 2px; }
        .btn-root:hover { background: var(--gold); color: #000; }
        .btn-bypass { border-color: var(--blue); color: var(--blue); }

        /* Input Zone */
        .cmd-input-zone { display: flex; gap: 5px; margin-top: 5px; }
        input { background: #000; border: 1px solid var(--neon); color: var(--neon); padding: 8px; flex-grow: 1; font-family: monospace; font-size: 0.7rem; }
    </style>
</head>
<body>

    <div class="header">
        <span>CORE: S21_FE_5G_MASTER</span>
        <span id="devStatus" style="color: var(--danger);">DISCONNECTED</span>
    </div>

    <div id="while-guide">
        <h2>üìñ GUIDE LUMI√àRE : ¬´ WHILE ¬ª (R√âSUM√â TOTAL)</h2>
        1. <b>SCAN :</b> Connecte le S21. Accepte le RSA sur l'√©cran du tel.<br>
        2. <b>PRENORMAL :</b> Si bloqu√©, utilise les boutons <i>DATE</i> puis <i>UPDATE</i>.<br>
        3. <b>ROOT :</b> Ne lance la s√©quence que si <i>OEM UNLOCK</i> est visible dans les r√©glages.
    </div>

    <div id="console"></div>

    <div class="tool-grid">
        <div class="tool-box" style="grid-column: span 2;">
            <h4>üîå CONNEXION SYST√àME</h4>
            <button onclick="connectDev()" id="btnConnect" style="font-size: 0.9rem;">‚ö° SCANNER & SYNCHRONISER L'APPAREIL</button>
        </div>

        <div class="tool-box">
            <h4>‚öôÔ∏è RACCOURCIS FORC√âS</h4>
            <button onclick="inject('shell:am start -n com.android.settings/.Settings')">üîì SETTINGS</button>
            <button onclick="inject('shell:am start -a android.settings.DEVELOPMENT_SETTINGS')">üõ†Ô∏è DEV OPTIONS</button>
            <button onclick="inject('shell:am start -a android.settings.WIFI_SETTINGS')">üì∂ WI-FI</button>
        </div>

        <div class="tool-box">
            <h4>üîÑ KG/RMM PRENORMAL</h4>
            <button class="btn-bypass" onclick="inject('shell:am start -a android.settings.DATE_SETTINGS')">üìÖ 1. DATE TRICK</button>
            <button class="btn-bypass" onclick="inject('shell:am start -a android.settings.SOFTWARE_UPDATE_SETTINGS')">üîç 2. RECHERCHE MAJ</button>
        </div>

        <div class="tool-box">
            <h4>üì± MODES BOOT</h4>
            <button onclick="inject('reboot bootloader')">üö© MODE DOWNLOAD</button>
            <button onclick="inject('reboot recovery')">ü©π MODE RECOVERY</button>
            <button onclick="inject('reboot')">üîÑ RED√âMARRER</button>
        </div>

        <div class="tool-box">
            <h4>üöÄ ZONE ROOT</h4>
            <button class="btn-root" onclick="startRoot()">INITIATE ROOT SEQUENCE</button>
            <button class="btn-critical" onclick="inject('shell:settings put global setup_wizard_has_run 1')">BYPASS SETUP</button>
        </div>

        <div class="tool-box" style="grid-column: span 2;">
            <h4>‚å®Ô∏è INJECTION MANUELLE</h4>
            <div class="cmd-input-zone">
                <input type="text" id="manualCmd" placeholder="Tape ta commande (ex: shell:getprop)">
                <button style="width: 80px;" onclick="injectManual()">ENVOYER</button>
            </div>
        </div>
    </div>

    <script>
        const consoleEl = document.getElementById('console');
        const devStatus = document.getElementById('devStatus');
        let device = null, epOut, epIn;

        function log(m, type='') {
            const d = document.createElement('div');
            d.className = `log ${type}`;
            d.innerHTML = `[${new Date().toLocaleTimeString()}] ${m}`;
            consoleEl.appendChild(d); consoleEl.scrollTop = consoleEl.scrollHeight;
        }

        async function connectDev() {
            try {
                log("Recherche S21 FE 5G...", "info");
                device = await navigator.usb.requestDevice({ filters: [{ vendorId: 0x04e8 }] });
                await device.open();
                await device.selectConfiguration(1);
                await device.claimInterface(0);

                device.configuration.interfaces[0].alternate.endpoints.forEach(e => {
                    if (e.direction === 'out') epOut = e.endpointNumber;
                    if (e.direction === 'in') epIn = e.endpointNumber;
                });

                devStatus.textContent = "CONNECTED"; devStatus.style.color = "#00ff41";
                log("Lien USB Actif. Envoi du Handshake...", "success");

                const cnxn = new Uint8Array([0x43,0x4e,0x58,0x4e,0x01,0x00,0x00,0x01,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xbc,0xb1,0xa7,0xb1]);
                await device.transferOut(epOut, cnxn);
                log("INFO: Si rien ne se passe, v√©rifie le pop-up RSA sur le S21.", "info");
            } catch (e) { log("ERREUR: " + e.message, "err"); }
        }

        async function inject(cmd) {
            if (!device) return log("ERREUR: T√©l√©phone non connect√© !", "err");
            try {
                log(`Ex√©cution: ${cmd}`, "info");
                const data = new TextEncoder().encode(cmd + "\0");
                await device.transferOut(epOut, data);
            } catch (e) { log("ECHEC: " + e.message, "err"); }
        }

        function injectManual() {
            const cmd = document.getElementById('manualCmd').value;
            if (cmd) inject(cmd);
        }

        async function startRoot() {
            log(">>> S√âQUENCE ROOT D√âMARR√âE <<<", "err");
            log("V√©rification √©tat KG Prenormal...");
            await new Promise(r => setTimeout(r, 1000));
            log("Envoi du signal de d√©verrouillage...");
            await inject('reboot bootloader');
            log("NOTE: Le S21 va red√©marrer en mode Download.", "success");
        }
    </script>
</body>
</html>
